% /*************************************************************************************
%
%    Project Name:  802.11ad Transmitter
%    File Name:     genDerivedParams.m
%    Authors:       Prem Kiran Nerella
%    Version:       1.0
%    History:       May 2014 created
%
%  *************************************************************************************
%    Description:
% 
%    function generates modulation and encoding parameters
%    for specified transmit configuration
%    
%    [genParams] = genDerivedParams(genParams)
%
%    Inputs:
%
%       1. genParams   - transmit configuration structure
%
%    Outputs:
%
%       1. genParams   - derived modulation and encoding parameters 
%                        are appended to transmit configuration structure
%
%  *************************************************************************************/
function [genParams] = genDerivedParams(genParams)

%Modulation and Encoding Parameters
%OFDM PHY
ofdm_mcs    = [13  14  15  16  17  18   19   20   21   22   23   24]; % MCS Index
ofdm_mod    = [0   0   1   1   1   2    2    2    2    3    3    3 ]; % 0-SQPSK ; 1-QPSK; 2-16QAM; 3-64QAM
ofdm_R      = [0   1   0   1   2   0    1    2    3    1    2    3 ]; % 0-1/2; 1-5/8; 2-3/4; 3-13/16
ofdm_Nbpsc  = [1   1   2   2   2   4    4    4    4    6    6    6 ]; %bits per subcarrier
ofdm_Ncbps  = [336 336 672 672 672 1344 1344 1344 1344 2016 2016 2016]; %coded bits per symbol
ofdm_Ndbps  = [168 210 336 420 504 672  840  1008 1092 1260 1512 1638]; %data bits per symbol
%SC PHY
sc_mcs = [1 2 3 4 5 6 7 8 9 10 11 12];
sc_Ncbps = [1 1 1 1 1 2 2 2 2 4 4 4];
sc_R = [0 0 1 2 3 0 1 2 3 0 1 2];
sc_mod = [0 0 0 0 0 1 1 1 1 2 2 2];
sc_rep = [2 1 1 1 1 1 1 1 1 1 1 1];
sc_Ncbpb = [448 448 448 448 448 896 896 896 896 1792 1792 1792];

mcs = genParams.txParams.payload.mcs;
derived_params = [];
%Derived modulation and encoding parameters for given OFDM PHY configuration
if(genParams.txParams.dmgmethod == 2)
    indx = find(ofdm_mcs == mcs);
    derived_params.modtype = ofdm_mod(indx);
    derived_params.R = ofdm_R(indx);
    derived_params.Nbpsc = ofdm_Nbpsc(indx);
    derived_params.Ncbps = ofdm_Ncbps(indx);
    derived_params.Ndbps = ofdm_Ndbps(indx);
end
%Derived modulation and encoding parameters for given SC PHY configuration
if(genParams.txParams.dmgmethod == 1)
    indx = find(sc_mcs == mcs);
    derived_params.modtype = sc_mod(indx);
    derived_params.R = sc_R(indx);
    derived_params.rep = sc_rep(indx);
    derived_params.Ncbps = sc_Ncbps(indx);
    derived_params.Ncbpb = sc_Ncbpb(indx);
end

derived_params.mcs = mcs;
derived_params.length = genParams.txParams.payload.length;

% LDPC parameters
dmgmethod = genParams.txParams.dmgmethod;
derived_params = genLDPCParams(derived_params,dmgmethod);
genMatrix = genLDPCGenMatrix(derived_params.R);
derived_params.ldpc.genMatrix = genMatrix;

%OFDM PHY IFFT parameters
%Pilot generation parameters
derived_params.ofdm.pilot_index = [-150 -130 -110 -90 -70 -50 -30 -10 10 30 50 70 90 110 130 150];
derived_params.ofdm.pilots = [-1 1 -1 1 1 -1 -1 -1 -1 -1 1 1 1 -1 1 1];
derived_params.ofdm.pilot_LFSRstate = [1 1 1 1 1 1 1];
%Data subcarrier parameters
derived_params.ofdm.data_index = [-177  -176  -175  -174  -173  -172  -171  -170  -169  -168  -167  -166 ...
  -165  -164  -163  -162  -161  -160  -159  -158  -157  -156  -155  -154 ...
  -153  -152  -151  -149  -148  -147  -146  -145  -144  -143  -142  -141 ...
  -140  -139  -138  -137  -136  -135  -134  -133  -132  -131  -129  -128 ...
  -127  -126  -125  -124  -123  -122  -121  -120  -119  -118  -117  -116 ...
  -115  -114  -113  -112  -111  -109  -108  -107  -106  -105  -104  -103 ...
  -102  -101  -100   -99   -98   -97   -96   -95   -94   -93   -92   -91 ...
   -89   -88   -87   -86   -85   -84   -83   -82   -81   -80   -79   -78 ...
   -77   -76   -75   -74   -73   -72   -71   -69   -68   -67   -66   -65 ...
   -64   -63   -62   -61   -60   -59   -58   -57   -56   -55   -54   -53 ...
   -52   -51   -49   -48   -47   -46   -45   -44   -43   -42   -41   -40 ...
   -39   -38   -37   -36   -35   -34   -33   -32   -31   -29   -28   -27 ...
   -26   -25   -24   -23   -22   -21   -20   -19   -18   -17   -16   -15 ...
   -14   -13   -12   -11    -9    -8    -7    -6    -5    -4    -3    -2 ...
     2     3     4     5     6     7     8     9    11    12    13    14 ...
    15    16    17    18    19    20    21    22    23    24    25    26 ...
    27    28    29    31    32    33    34    35    36    37    38    39 ...
    40    41    42    43    44    45    46    47    48    49    51    52 ...
    53    54    55    56    57    58    59    60    61    62    63    64 ...
    65    66    67    68    69    71    72    73    74    75    76    77 ...
    78    79    80    81    82    83    84    85    86    87    88    89 ...
    91    92    93    94    95    96    97    98    99   100   101   102 ...
   103   104   105   106   107   108   109   111   112   113   114   115 ...
   116   117   118   119   120   121   122   123   124   125   126   127 ...
   128   129   131   132   133   134   135   136   137   138   139   140 ...
   141   142   143   144   145   146   147   148   149   151   152   153 ...
   154   155   156   157   158   159   160   161   162   163   164   165 ...
   166   167   168   169   170   171   172   173   174   175   176   177];
derived_params.ofdm.subc_index = [-177  -176  -175  -174  -173  -172  -171  -170  -169  -168  -167  -166 ... 
  -165  -164  -163  -162  -161  -160  -159  -158  -157  -156  -155  -154 ...
  -153  -152  -151  -150  -149  -148  -147  -146  -145  -144  -143  -142 ...
  -141  -140  -139  -138  -137  -136  -135  -134  -133  -132  -131  -130 ...
  -129  -128  -127  -126  -125  -124  -123  -122  -121  -120  -119  -118 ...
  -117  -116  -115  -114  -113  -112  -111  -110  -109  -108  -107  -106 ...
  -105  -104  -103  -102  -101  -100   -99   -98   -97   -96   -95   -94 ...
   -93   -92   -91   -90   -89   -88   -87   -86   -85   -84   -83   -82 ...
   -81   -80   -79   -78   -77   -76   -75   -74   -73   -72   -71   -70 ...
   -69   -68   -67   -66   -65   -64   -63   -62   -61   -60   -59   -58 ...
   -57   -56   -55   -54   -53   -52   -51   -50   -49   -48   -47   -46 ...
   -45   -44   -43   -42   -41   -40   -39   -38   -37   -36   -35   -34 ...
   -33   -32   -31   -30   -29   -28   -27   -26   -25   -24   -23   -22 ...
   -21   -20   -19   -18   -17   -16   -15   -14   -13   -12   -11   -10 ...
    -9    -8    -7    -6    -5    -4    -3    -2     2     3     4     5 ...
     6     7     8     9    10    11    12    13    14    15    16    17 ...
    18    19    20    21    22    23    24    25    26    27    28    29 ...
    30    31    32    33    34    35    36    37    38    39    40    41 ...
    42    43    44    45    46    47    48    49    50    51    52    53 ...
    54    55    56    57    58    59    60    61    62    63    64    65 ...
    66    67    68    69    70    71    72    73    74    75    76    77 ...
    78    79    80    81    82    83    84    85    86    87    88    89 ...
    90    91    92    93    94    95    96    97    98    99   100   101 ...
   102   103   104   105   106   107   108   109   110   111   112   113 ...
   114   115   116   117   118   119   120   121   122   123   124   125 ...
   126   127   128   129   130   131   132   133   134   135   136   137 ...
   138   139   140   141   142   143   144   145   146   147   148   149 ...
   150   151   152   153   154   155   156   157   158   159   160   161 ...
   162   163   164   165   166   167   168   169   170   171   172   173 ...
   174   175   176   177];

% Header Parameters
genParams.header = genParams.txParams.payload;
genParams.derived_params = derived_params;

genParams.randGen.payload_Useed  = genParams.header.payload_seed;
genParams.randGen.payload_Ustate = genParams.header.payload_state;
genParams.randGen.payload_Nseed  = genParams.header.payload_seed;
genParams.randGen.payload_Nstate = genParams.header.payload_state;

rstate = genParams.header.payload_state;

return
